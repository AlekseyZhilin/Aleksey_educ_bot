{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"name":"Копия блокнота \"Aleksey_educ_bot\"","provenance":[{"file_id":"10zE59Y7S_-3oXQ0ALuZa3hPYP_B-5TcE","timestamp":1658586687464},{"file_id":"1qse8dyC12eRB09KcmEQQgNu9XUz6PIZW","timestamp":1658565457570},{"file_id":"1zPF7J4sb6i3BqSHA6Re7WEakrfaLR-2o","timestamp":1658564358828},{"file_id":"1iQpnJoptBALtPqZ5N-7Lv9wwPl7W9JYv","timestamp":1658518935195},{"file_id":"1Elasp7so0oR40nIk_WBy2CtSKYVLaTS7","timestamp":1658437118482},{"file_id":"1X-O7OfYGdKIQU87CEgm9qkLCR-IcLhsY","timestamp":1658432250855},{"file_id":"1oHS6Bwkm9dH9VZ7xJZKi62DB7N1D8-4E","timestamp":1658347002201},{"file_id":"1MwangBlna1X5NeRnKbCsifBmBJgVA-9c","timestamp":1658259494874},{"file_id":"14fqXCHL-ruX3BWrECvu8_hUrOnqvwkrV","timestamp":1658162351418},{"file_id":"1lwirTIKtX7Z2afqAlAXGuyeQW8E0gP0C","timestamp":1658071669550}],"collapsed_sections":[],"mount_file_id":"10zE59Y7S_-3oXQ0ALuZa3hPYP_B-5TcE","authorship_tag":"ABX9TyNHvv9w20PbOuBsxTRTm/Cn"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"gpuClass":"standard","widgets":{"application/vnd.jupyter.widget-state+json":{"9d0807341de14e6e9ee1a24bccb3b5f7":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_f411bf9711b44643a2b3faaad15b4b5b","IPY_MODEL_075d5acad5d24dda97b3ab2c309614eb","IPY_MODEL_077aaf15322249e6a4b0667caba76723"],"layout":"IPY_MODEL_153830ff19a94ae1b4d6c90fbd143d09"}},"f411bf9711b44643a2b3faaad15b4b5b":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_82a216d88dbf44e7831e96ed9cd586d9","placeholder":"​","style":"IPY_MODEL_e88bea0d2e0a44038c7d7cfc3973213a","value":""}},"075d5acad5d24dda97b3ab2c309614eb":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_5c734efe7b13433d88f2ec02d499ba2e","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_b506bc53ec0947bea8a4c9c01f662e7c","value":1}},"077aaf15322249e6a4b0667caba76723":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0df888edba844a5dbc5e0d20fb31ad58","placeholder":"​","style":"IPY_MODEL_057667e499404bb4bf8434ad89db9f5a","value":" 7550926/? [00:54&lt;00:00, 208730.26it/s]"}},"153830ff19a94ae1b4d6c90fbd143d09":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"82a216d88dbf44e7831e96ed9cd586d9":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e88bea0d2e0a44038c7d7cfc3973213a":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"5c734efe7b13433d88f2ec02d499ba2e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"b506bc53ec0947bea8a4c9c01f662e7c":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"0df888edba844a5dbc5e0d20fb31ad58":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"057667e499404bb4bf8434ad89db9f5a":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"7f1188b673e14549811a008603cd5a44":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_a45d3f3de53c4ade8f38d4e00ea88f0e","IPY_MODEL_76dbe01a40eb450bae82ea764d21a16f","IPY_MODEL_3e7a5a1b993c4c07a1f60ab6a3f3f928"],"layout":"IPY_MODEL_63b53dc35348428eabdca7fb4379bfda"}},"a45d3f3de53c4ade8f38d4e00ea88f0e":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_48a5b6d6808b400ababa53eda69bd3dc","placeholder":"​","style":"IPY_MODEL_decee4c19c6c4eb098b0bf47e77dc266","value":""}},"76dbe01a40eb450bae82ea764d21a16f":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"danger","description":"","description_tooltip":null,"layout":"IPY_MODEL_cc7cc6a5d3774ee687298a30674ba6ff","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_f94a708f2657431ab4e454aefc2654b1","value":1}},"3e7a5a1b993c4c07a1f60ab6a3f3f928":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_6ce41842f2794daa930486b598a47461","placeholder":"​","style":"IPY_MODEL_7f3acf56159c473fb82ee03bdb6c187b","value":" 500000/? [47:18&lt;00:00, 196.21it/s]"}},"63b53dc35348428eabdca7fb4379bfda":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"48a5b6d6808b400ababa53eda69bd3dc":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"decee4c19c6c4eb098b0bf47e77dc266":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"cc7cc6a5d3774ee687298a30674ba6ff":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"f94a708f2657431ab4e454aefc2654b1":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"6ce41842f2794daa930486b598a47461":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"7f3acf56159c473fb82ee03bdb6c187b":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"2622d622da754e27905207bfaaadf8c7":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_5248feb3ed4741e6bf8555cb2689ae43","IPY_MODEL_75efc759a60f41f9acae1e0ae6fe6379","IPY_MODEL_b897750c7c504833a441cff655256158"],"layout":"IPY_MODEL_30759eb601bb4e06b4490c1cc41f7e89"}},"5248feb3ed4741e6bf8555cb2689ae43":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_bb352a866bd74f11a66173f5794116ee","placeholder":"​","style":"IPY_MODEL_cd94a74d2dd84348bb2d87dfa320607e","value":""}},"75efc759a60f41f9acae1e0ae6fe6379":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_e6204b6b9b0046f7aa44d61cd757224d","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_babec052aae44d18aefa6a09eaad2de9","value":1}},"b897750c7c504833a441cff655256158":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_49311a728020455c92e4b1c77230517d","placeholder":"​","style":"IPY_MODEL_9f008ae421af4de2bcdf75d5611703ea","value":" 1163342/? [1:49:51&lt;00:00, 94.05it/s]"}},"30759eb601bb4e06b4490c1cc41f7e89":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"bb352a866bd74f11a66173f5794116ee":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"cd94a74d2dd84348bb2d87dfa320607e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"e6204b6b9b0046f7aa44d61cd757224d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"babec052aae44d18aefa6a09eaad2de9":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"49311a728020455c92e4b1c77230517d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9f008ae421af4de2bcdf75d5611703ea":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"fa8f01a2a44c43c08861ada91efedafa":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_3f68cf4378014b9e909bd550dc192303","IPY_MODEL_5898aa5868554765934c793122228db4","IPY_MODEL_ace8a73b8b0e42f4a0c09f88d3da084f"],"layout":"IPY_MODEL_8b8765dfdeb2463697e09c0b443d1397"}},"3f68cf4378014b9e909bd550dc192303":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_f178cc45cbb84a32916e80633b02b72c","placeholder":"​","style":"IPY_MODEL_26b7f7b478cd49eab9bbab15e9cc94ba","value":"100%"}},"5898aa5868554765934c793122228db4":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_5709f5220d4246b38715778b0e893c0d","max":10000,"min":0,"orientation":"horizontal","style":"IPY_MODEL_472c11324ef24dff8470c4914a092952","value":10000}},"ace8a73b8b0e42f4a0c09f88d3da084f":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_ae1ccffb9bb145688e497e5129a78cfc","placeholder":"​","style":"IPY_MODEL_f1715ef2dc38432ab34591cdc487db5d","value":" 10000/10000 [03:09&lt;00:00, 39.45it/s]"}},"8b8765dfdeb2463697e09c0b443d1397":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f178cc45cbb84a32916e80633b02b72c":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"26b7f7b478cd49eab9bbab15e9cc94ba":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"5709f5220d4246b38715778b0e893c0d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"472c11324ef24dff8470c4914a092952":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"ae1ccffb9bb145688e497e5129a78cfc":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f1715ef2dc38432ab34591cdc487db5d":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"markdown","source":["### Установка библиотек"],"metadata":{"id":"vIxOqEtHtbwx"}},{"cell_type":"code","source":["!pip install python-telegram-bot"],"metadata":{"id":"HYTXoArstgzz","colab":{"base_uri":"https://localhost:8080/","height":676},"executionInfo":{"status":"ok","timestamp":1658546637361,"user_tz":-180,"elapsed":6363,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"cf7d8a03-0ad7-4c8a-ddcf-c60328a1bcda"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting python-telegram-bot\n","  Downloading python_telegram_bot-13.13-py3-none-any.whl (513 kB)\n","\u001b[K     |████████████████████████████████| 513 kB 5.7 MB/s \n","\u001b[?25hCollecting tornado>=6.1\n","  Downloading tornado-6.2-cp37-abi3-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (423 kB)\n","\u001b[K     |████████████████████████████████| 423 kB 52.7 MB/s \n","\u001b[?25hRequirement already satisfied: certifi in /usr/local/lib/python3.7/dist-packages (from python-telegram-bot) (2022.6.15)\n","Requirement already satisfied: pytz>=2018.6 in /usr/local/lib/python3.7/dist-packages (from python-telegram-bot) (2022.1)\n","Collecting APScheduler==3.6.3\n","  Downloading APScheduler-3.6.3-py2.py3-none-any.whl (58 kB)\n","\u001b[K     |████████████████████████████████| 58 kB 6.2 MB/s \n","\u001b[?25hCollecting cachetools==4.2.2\n","  Downloading cachetools-4.2.2-py3-none-any.whl (11 kB)\n","Requirement already satisfied: tzlocal>=1.2 in /usr/local/lib/python3.7/dist-packages (from APScheduler==3.6.3->python-telegram-bot) (1.5.1)\n","Requirement already satisfied: six>=1.4.0 in /usr/local/lib/python3.7/dist-packages (from APScheduler==3.6.3->python-telegram-bot) (1.15.0)\n","Requirement already satisfied: setuptools>=0.7 in /usr/local/lib/python3.7/dist-packages (from APScheduler==3.6.3->python-telegram-bot) (57.4.0)\n","Installing collected packages: tornado, cachetools, APScheduler, python-telegram-bot\n","  Attempting uninstall: tornado\n","    Found existing installation: tornado 5.1.1\n","    Uninstalling tornado-5.1.1:\n","      Successfully uninstalled tornado-5.1.1\n","  Attempting uninstall: cachetools\n","    Found existing installation: cachetools 4.2.4\n","    Uninstalling cachetools-4.2.4:\n","      Successfully uninstalled cachetools-4.2.4\n","\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\n","google-colab 1.0.0 requires tornado~=5.1.0, but you have tornado 6.2 which is incompatible.\u001b[0m\n","Successfully installed APScheduler-3.6.3 cachetools-4.2.2 python-telegram-bot-13.13 tornado-6.2\n"]},{"output_type":"display_data","data":{"application/vnd.colab-display-data+json":{"pip_warning":{"packages":["tornado"]}}},"metadata":{}}]},{"cell_type":"code","source":["!pip install python-telegram-bot --upgrade"],"metadata":{"id":"4_8UWgu80Vu1","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1658546912904,"user_tz":-180,"elapsed":3987,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"16460f84-ca3b-4f66-cd5c-64b589e07d31"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: python-telegram-bot in /usr/local/lib/python3.7/dist-packages (13.13)\n","Requirement already satisfied: pytz>=2018.6 in /usr/local/lib/python3.7/dist-packages (from python-telegram-bot) (2022.1)\n","Requirement already satisfied: APScheduler==3.6.3 in /usr/local/lib/python3.7/dist-packages (from python-telegram-bot) (3.6.3)\n","Requirement already satisfied: certifi in /usr/local/lib/python3.7/dist-packages (from python-telegram-bot) (2022.6.15)\n","Requirement already satisfied: tornado>=6.1 in /usr/local/lib/python3.7/dist-packages (from python-telegram-bot) (6.2)\n","Requirement already satisfied: cachetools==4.2.2 in /usr/local/lib/python3.7/dist-packages (from python-telegram-bot) (4.2.2)\n","Requirement already satisfied: tzlocal>=1.2 in /usr/local/lib/python3.7/dist-packages (from APScheduler==3.6.3->python-telegram-bot) (1.5.1)\n","Requirement already satisfied: six>=1.4.0 in /usr/local/lib/python3.7/dist-packages (from APScheduler==3.6.3->python-telegram-bot) (1.15.0)\n","Requirement already satisfied: setuptools>=0.7 in /usr/local/lib/python3.7/dist-packages (from APScheduler==3.6.3->python-telegram-bot) (57.4.0)\n"]}]},{"cell_type":"code","source":["# перезапускаем среду выполнения"],"metadata":{"id":"akN77Paofm4G"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["!pip install pymorphy2\n","!pip install stop_words\n","!pip install annoy"],"metadata":{"id":"VZh8caL7nasd","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1658570993571,"user_tz":-180,"elapsed":32454,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"52c88ed9-b104-4557-94cd-e664a884ebb7"},"execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting pymorphy2\n","  Downloading pymorphy2-0.9.1-py3-none-any.whl (55 kB)\n","\u001b[K     |████████████████████████████████| 55 kB 1.7 MB/s \n","\u001b[?25hRequirement already satisfied: docopt>=0.6 in /usr/local/lib/python3.7/dist-packages (from pymorphy2) (0.6.2)\n","Collecting dawg-python>=0.7.1\n","  Downloading DAWG_Python-0.7.2-py2.py3-none-any.whl (11 kB)\n","Collecting pymorphy2-dicts-ru<3.0,>=2.4\n","  Downloading pymorphy2_dicts_ru-2.4.417127.4579844-py2.py3-none-any.whl (8.2 MB)\n","\u001b[K     |████████████████████████████████| 8.2 MB 38.2 MB/s \n","\u001b[?25hInstalling collected packages: pymorphy2-dicts-ru, dawg-python, pymorphy2\n","Successfully installed dawg-python-0.7.2 pymorphy2-0.9.1 pymorphy2-dicts-ru-2.4.417127.4579844\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting stop_words\n","  Downloading stop-words-2018.7.23.tar.gz (31 kB)\n","Building wheels for collected packages: stop-words\n","  Building wheel for stop-words (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for stop-words: filename=stop_words-2018.7.23-py3-none-any.whl size=32911 sha256=843f01ad7ea8428deaa3f15dbbd7aa620c3306dfdadfc9e1bd5bc1c3d8001f36\n","  Stored in directory: /root/.cache/pip/wheels/fb/86/b2/277b10b1ce9f73ce15059bf6975d4547cc4ec3feeb651978e9\n","Successfully built stop-words\n","Installing collected packages: stop-words\n","Successfully installed stop-words-2018.7.23\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting annoy\n","  Downloading annoy-1.17.0.tar.gz (646 kB)\n","\u001b[K     |████████████████████████████████| 646 kB 9.9 MB/s \n","\u001b[?25hBuilding wheels for collected packages: annoy\n","  Building wheel for annoy (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for annoy: filename=annoy-1.17.0-cp37-cp37m-linux_x86_64.whl size=391583 sha256=81b4223c7308264cca2afa5b533ea1bd3f3dba78d4585a3a78a63d7187fc8574\n","  Stored in directory: /root/.cache/pip/wheels/4f/e8/1e/7cc9ebbfa87a3b9f8ba79408d4d31831d67eea918b679a4c07\n","Successfully built annoy\n","Installing collected packages: annoy\n","Successfully installed annoy-1.17.0\n"]}]},{"cell_type":"code","source":["from pymorphy2 import MorphAnalyzer\n","from stop_words import get_stop_words\n","import string\n","import datetime\n","import annoy\n","from gensim.models import Word2Vec, FastText\n","import pickle\n","import numpy as np\n","from tqdm import tqdm_notebook\n","import pandas as pd"],"metadata":{"id":"TflffLzTnJBh","executionInfo":{"status":"ok","timestamp":1658571001718,"user_tz":-180,"elapsed":2301,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":2,"outputs":[]},{"cell_type":"markdown","source":["### Блок обработки текста"],"metadata":{"id":"1h1JRi0woCdF"}},{"cell_type":"code","source":["morpher = MorphAnalyzer()\n","stop_words = set(get_stop_words(\"ru\"))\n","exclude = set(string.punctuation)"],"metadata":{"id":"5X6ECkgGol6m","executionInfo":{"status":"ok","timestamp":1658571005432,"user_tz":-180,"elapsed":904,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":3,"outputs":[]},{"cell_type":"code","source":["# удаляем слово \"время\" из множества stop_words\n","stop_words.discard('время')"],"metadata":{"id":"FE07kHsStfHb"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["def preprocess_txt(input_txt):\n","    txt = \"\".join(i for i in input_txt.strip() if i not in exclude).split()\n","    txt = [morpher.parse(i.lower())[0].normal_form for i in txt]\n","    txt = [i for i in txt if i not in stop_words and i != \"\"]\n","    return txt"],"metadata":{"id":"S_MQT9_7lcoR","executionInfo":{"status":"ok","timestamp":1658571010007,"user_tz":-180,"elapsed":358,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":4,"outputs":[]},{"cell_type":"code","source":["# Пути к данным\n","path_otvety = '/content/drive/MyDrive/Otvety.txt'\n","path_prepared_answers = '/content/drive/MyDrive/prepared_answers.txt'\n","path_model = '/content/drive/MyDrive/ft_model'\n","path_index = '/content/drive/MyDrive/speaker.ann'\n","path_index_speaker = '/content/drive/MyDrive/index_speaker.pkl'\n","path_recepies = '/content/drive/MyDrive/recepies.csv'\n","path_index_recepies_ann = '/content/drive/MyDrive/recepies.ann'\n","path_index_recepies = '/content/drive/MyDrive/recepies.pkl'"],"metadata":{"id":"e04tCBWYr8TY","executionInfo":{"status":"ok","timestamp":1658583068138,"user_tz":-180,"elapsed":374,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":57,"outputs":[]},{"cell_type":"code","source":["assert True\n","#Данные для режима болтанки\n","question = None\n","written = False\n","\n","with open(path_prepared_answers, \"w\") as fout:\n","    with open(path_otvety, \"r\") as fin:\n","        for line in tqdm_notebook(fin):\n","            if line.startswith(\"---\"):\n","                written = False\n","                continue\n","            if not written and question is not None:\n","                fout.write(question.replace(\"\\t\", \" \").strip() + \"\\t\" + line.replace(\"\\t\", \" \"))\n","                written = True\n","                question = None\n","                continue\n","            if not written:\n","                question = line.strip()\n","                continue"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":101,"referenced_widgets":["9d0807341de14e6e9ee1a24bccb3b5f7","f411bf9711b44643a2b3faaad15b4b5b","075d5acad5d24dda97b3ab2c309614eb","077aaf15322249e6a4b0667caba76723","153830ff19a94ae1b4d6c90fbd143d09","82a216d88dbf44e7831e96ed9cd586d9","e88bea0d2e0a44038c7d7cfc3973213a","5c734efe7b13433d88f2ec02d499ba2e","b506bc53ec0947bea8a4c9c01f662e7c","0df888edba844a5dbc5e0d20fb31ad58","057667e499404bb4bf8434ad89db9f5a"]},"id":"jdWwbtmJGvrA","executionInfo":{"status":"ok","timestamp":1658551240403,"user_tz":-180,"elapsed":54815,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"246549e7-6e2f-4f85-9ce1-433b1c81276f"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:10: TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0\n","Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`\n","  # Remove the CWD from sys.path while we load stuff.\n"]},{"output_type":"display_data","data":{"text/plain":["0it [00:00, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"9d0807341de14e6e9ee1a24bccb3b5f7"}},"metadata":{}}]},{"cell_type":"code","source":["assert True\n","\n","# Preprocess for models fitting\n","sentences = []\n","c = 0\n","\n","with open(path_otvety, \"r\") as fin:\n","    for line in tqdm_notebook(fin):\n","        spls = preprocess_txt(line)\n","        sentences.append(spls)\n","        c += 1\n","        if c > 500000:\n","            break"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":101,"referenced_widgets":["7f1188b673e14549811a008603cd5a44","a45d3f3de53c4ade8f38d4e00ea88f0e","76dbe01a40eb450bae82ea764d21a16f","3e7a5a1b993c4c07a1f60ab6a3f3f928","63b53dc35348428eabdca7fb4379bfda","48a5b6d6808b400ababa53eda69bd3dc","decee4c19c6c4eb098b0bf47e77dc266","cc7cc6a5d3774ee687298a30674ba6ff","f94a708f2657431ab4e454aefc2654b1","6ce41842f2794daa930486b598a47461","7f3acf56159c473fb82ee03bdb6c187b"]},"id":"BVVyRfcyQIhm","executionInfo":{"status":"ok","timestamp":1658554089311,"user_tz":-180,"elapsed":2839584,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"017ae528-c4fd-4248-f06a-4c5f0d1d34de"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:8: TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0\n","Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`\n","  \n"]},{"output_type":"display_data","data":{"text/plain":["0it [00:00, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"7f1188b673e14549811a008603cd5a44"}},"metadata":{}}]},{"cell_type":"code","source":["sentences = [i for i in sentences if len(i) > 2]\n","print('start train fasttext')\n","modelFT = FastText(sentences=sentences, size=100, min_count=1, window=5, workers=8)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"YDQWLT2xQ6XT","executionInfo":{"status":"ok","timestamp":1658554683553,"user_tz":-180,"elapsed":571629,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"59cdd448-0ee9-4ab3-8b4f-7c7e5f12a8ca"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["start train fasttext\n"]}]},{"cell_type":"code","source":["modelFT.save(path_model)"],"metadata":{"id":"n2Xg866chzhj"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["modelFT = FastText.load(path_model)"],"metadata":{"id":"aJnv82wbsQ8k","executionInfo":{"status":"ok","timestamp":1658573644430,"user_tz":-180,"elapsed":17678,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":19,"outputs":[]},{"cell_type":"code","source":["ft_index = annoy.AnnoyIndex(100 ,'angular')\n","\n","index_map = {}\n","counter = 0\n","\n","with open(path_prepared_answers, \"r\") as f:\n","    for line in tqdm_notebook(f):\n","        n_ft = 0\n","        spls = line.split(\"\\t\")\n","        index_map[counter] = spls[1]\n","        question = preprocess_txt(spls[0])\n","        vector_ft = np.zeros(100)\n","        for word in question:\n","            if word in modelFT.wv:\n","                vector_ft += modelFT.wv[word]\n","                n_ft += 1\n","        if n_ft > 0:\n","            vector_ft = vector_ft / n_ft\n","        ft_index.add_item(counter, vector_ft)\n","            \n","        counter += 1\n","\n","ft_index.build(10)\n","ft_index.save(path_index)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":118,"referenced_widgets":["2622d622da754e27905207bfaaadf8c7","5248feb3ed4741e6bf8555cb2689ae43","75efc759a60f41f9acae1e0ae6fe6379","b897750c7c504833a441cff655256158","30759eb601bb4e06b4490c1cc41f7e89","bb352a866bd74f11a66173f5794116ee","cd94a74d2dd84348bb2d87dfa320607e","e6204b6b9b0046f7aa44d61cd757224d","babec052aae44d18aefa6a09eaad2de9","49311a728020455c92e4b1c77230517d","9f008ae421af4de2bcdf75d5611703ea"]},"id":"XL5DiT0TRGU6","executionInfo":{"status":"ok","timestamp":1658580306346,"user_tz":-180,"elapsed":6622761,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"c2c8dfcf-102d-42c0-c439-7d3e1e0101a3"},"execution_count":20,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:7: TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0\n","Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`\n","  import sys\n"]},{"output_type":"display_data","data":{"text/plain":["0it [00:00, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"2622d622da754e27905207bfaaadf8c7"}},"metadata":{}},{"output_type":"execute_result","data":{"text/plain":["True"]},"metadata":{},"execution_count":20}]},{"cell_type":"code","source":["with open(path_index_speaker, \"wb\") as f:\n","    pickle.dump(index_map, f)"],"metadata":{"id":"SaqHynHNF9bk","executionInfo":{"status":"ok","timestamp":1658580701054,"user_tz":-180,"elapsed":10752,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":25,"outputs":[]},{"cell_type":"code","source":["with open(path_index_speaker, 'rb') as f:\n","    index_map = pickle.load(f)"],"metadata":{"id":"C8MZKHjqF97L","executionInfo":{"status":"ok","timestamp":1658580720980,"user_tz":-180,"elapsed":8286,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":26,"outputs":[]},{"cell_type":"code","source":["# Загрузка обученной модели\n","modelFT = FastText.load(path_model)\n","ft_index = annoy.AnnoyIndex(100, 'angular')\n","ft_index.load(path_index) \n","ft_index.get_nns_by_vector(np.zeros(100), 2)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"_yyW640ARMtY","executionInfo":{"status":"ok","timestamp":1658571155315,"user_tz":-180,"elapsed":33455,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"986c2c8f-2bf8-4a09-f908-bb6a3ead7c50"},"execution_count":8,"outputs":[{"output_type":"execute_result","data":{"text/plain":["[7173, 52674]"]},"metadata":{},"execution_count":8}]},{"cell_type":"code","source":["def embed_txt(txt, idfs, midf):\n","    n_ft = 0\n","    vector_ft = np.zeros(100)\n","    for word in txt:\n","        if word in modelFT.wv:\n","            vector_ft += modelFT.wv[word] * 1 # idfs.get(word, midf)\n","            n_ft += 1 # idfs.get(word, midf)\n","    return vector_ft / n_ft"],"metadata":{"id":"n3PDxzBAj1Jv","executionInfo":{"status":"ok","timestamp":1658571434249,"user_tz":-180,"elapsed":372,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":9,"outputs":[]},{"cell_type":"code","source":["# Тест модели для болтанки\n","vect_ft = embed_txt(preprocess_txt('привет'), {}, 1)\n","ft_index_val, distances = ft_index.get_nns_by_vector(vect_ft, 1, include_distances=True)\n","index_map[ft_index_val[0]]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":36},"id":"3K9rkJwcnSlM","executionInfo":{"status":"ok","timestamp":1658584668594,"user_tz":-180,"elapsed":357,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"e9664a76-3e07-49bb-cff0-4bc12869ff21"},"execution_count":85,"outputs":[{"output_type":"execute_result","data":{"text/plain":["'Привет, тебя всегда приятно видеть!. \\n'"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"}},"metadata":{},"execution_count":85}]},{"cell_type":"markdown","source":["##### Дообучение модели на втором наборе данных"],"metadata":{"id":"z5fieOjWI8Ek"}},{"cell_type":"code","source":["# Загрузка датасета с рецептами\n","rec_data = pd.read_csv('/content/drive/MyDrive/all_recepies_inter.csv', sep='\\t')\n","\n","\n","rec_data['text'] = rec_data['name'] + \" \" + rec_data['Инструкции']\n","rec_data['text'] = rec_data['text'].apply(lambda x: preprocess_txt(str(x)))"],"metadata":{"id":"I713RM9-X9Km"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["rec_data.to_csv(path_recepies, encoding='utf-8', index=False)"],"metadata":{"id":"UON4LvI6FUVR"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["rec_data = pd.read_csv(path_recepies)\n","rec_data.head()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":600},"id":"SWKoIq-FFt5l","executionInfo":{"status":"ok","timestamp":1658585905607,"user_tz":-180,"elapsed":3799,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"6ae9860e-855f-4074-8736-6d75949e2a81"},"execution_count":93,"outputs":[{"output_type":"execute_result","data":{"text/plain":["   Unnamed: 0                                               name  \\\n","0           0  рассольник классический с перловкой и солеными...   \n","1           1                    Суп пюре из белокочаной капусты   \n","2           2                     Постные щи из квашеной капусты   \n","3           3                  Тюря- простой суп быстро и вкусно   \n","4           4                    Фасолевый суп из красной фасоли   \n","\n","                                         composition         cooking_type  \\\n","0  [{'Перловка': 0.1, 'unit': 'стак. (200 мл)'}, ...          варка,жарка   \n","1  [{'Капуста белокочанная': 50.0, 'unit': 'гр'},...                варка   \n","2  [{'Капуста квашеная': 116.7, 'unit': 'гр'}, {'...  варка,жарка,тушение   \n","3  [{'Квас': 0.2, 'unit': 'л'}, {'Лук репчатый': ...                сырое   \n","4  [{'Вода': 0.3, 'unit': 'л'}, {'Картошка': 0.3,...                варка   \n","\n","                                          Инструкции dish_type        Дата  \\\n","0  Подготовить указанные ингредиенты для приготов...    первое  05.06.2015   \n","1  Необходимые ингредиенты\\r\\nНарезаем лук, морко...    первое  27.06.2015   \n","2  Честно признаюсь, у меня не было репы на момен...    первое  12.02.2013   \n","3  \\r\\nНачинаем мы приготовление тюри с того, что...    первое  02.03.2011   \n","4  Подготовить ингредиенты. Для приготовления суп...    первое  28.01.2013   \n","\n","                  photo                                             source  \\\n","0  photo_1000menu_1.jpg  https://1000.menu/cooking/33395-rassolnik-s-pe...   \n","1  photo_1000menu_2.jpg  https://1000.menu/cooking/25399-sup-pure-iz-be...   \n","2  photo_1000menu_3.jpg       https://1000.menu/cooking/5159-postnje-shchi   \n","3  photo_1000menu_4.jpg               https://1000.menu/cooking/5085-turya   \n","4  photo_1000menu_5.jpg  https://1000.menu/cooking/38765-fasolevyi-sup-...   \n","\n","                                   composition_inter  \\\n","0  [{'product_id': 4253, 'name_source': 'Перловая...   \n","1  [{'product_id': 2286, 'name_source': 'Капуста ...   \n","2  [{'product_id': 0, 'name_source': 'Капуста ква...   \n","3  [{'product_id': 0, 'name_source': 'Квас', 'uni...   \n","4  [{'product_id': 828, 'name_source': 'Вода', 'u...   \n","\n","                                                text  \n","0  ['рассольник', 'классический', 'перловка', 'со...  \n","1  ['суп', 'пюре', 'белокочаный', 'капуста', 'нео...  \n","2  ['постный', 'щи', 'квашеный', 'капуста', 'чест...  \n","3  ['тюря', 'простой', 'суп', 'быстро', 'вкусно',...  \n","4  ['фасолевый', 'суп', 'красный', 'фасоль', 'под...  "],"text/html":["\n","  <div id=\"df-eaf8a283-21a3-4b97-a29e-ad5cb29c4125\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>Unnamed: 0</th>\n","      <th>name</th>\n","      <th>composition</th>\n","      <th>cooking_type</th>\n","      <th>Инструкции</th>\n","      <th>dish_type</th>\n","      <th>Дата</th>\n","      <th>photo</th>\n","      <th>source</th>\n","      <th>composition_inter</th>\n","      <th>text</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0</td>\n","      <td>рассольник классический с перловкой и солеными...</td>\n","      <td>[{'Перловка': 0.1, 'unit': 'стак. (200 мл)'}, ...</td>\n","      <td>варка,жарка</td>\n","      <td>Подготовить указанные ингредиенты для приготов...</td>\n","      <td>первое</td>\n","      <td>05.06.2015</td>\n","      <td>photo_1000menu_1.jpg</td>\n","      <td>https://1000.menu/cooking/33395-rassolnik-s-pe...</td>\n","      <td>[{'product_id': 4253, 'name_source': 'Перловая...</td>\n","      <td>['рассольник', 'классический', 'перловка', 'со...</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>1</td>\n","      <td>Суп пюре из белокочаной капусты</td>\n","      <td>[{'Капуста белокочанная': 50.0, 'unit': 'гр'},...</td>\n","      <td>варка</td>\n","      <td>Необходимые ингредиенты\\r\\nНарезаем лук, морко...</td>\n","      <td>первое</td>\n","      <td>27.06.2015</td>\n","      <td>photo_1000menu_2.jpg</td>\n","      <td>https://1000.menu/cooking/25399-sup-pure-iz-be...</td>\n","      <td>[{'product_id': 2286, 'name_source': 'Капуста ...</td>\n","      <td>['суп', 'пюре', 'белокочаный', 'капуста', 'нео...</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>2</td>\n","      <td>Постные щи из квашеной капусты</td>\n","      <td>[{'Капуста квашеная': 116.7, 'unit': 'гр'}, {'...</td>\n","      <td>варка,жарка,тушение</td>\n","      <td>Честно признаюсь, у меня не было репы на момен...</td>\n","      <td>первое</td>\n","      <td>12.02.2013</td>\n","      <td>photo_1000menu_3.jpg</td>\n","      <td>https://1000.menu/cooking/5159-postnje-shchi</td>\n","      <td>[{'product_id': 0, 'name_source': 'Капуста ква...</td>\n","      <td>['постный', 'щи', 'квашеный', 'капуста', 'чест...</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>3</td>\n","      <td>Тюря- простой суп быстро и вкусно</td>\n","      <td>[{'Квас': 0.2, 'unit': 'л'}, {'Лук репчатый': ...</td>\n","      <td>сырое</td>\n","      <td>\\r\\nНачинаем мы приготовление тюри с того, что...</td>\n","      <td>первое</td>\n","      <td>02.03.2011</td>\n","      <td>photo_1000menu_4.jpg</td>\n","      <td>https://1000.menu/cooking/5085-turya</td>\n","      <td>[{'product_id': 0, 'name_source': 'Квас', 'uni...</td>\n","      <td>['тюря', 'простой', 'суп', 'быстро', 'вкусно',...</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>4</td>\n","      <td>Фасолевый суп из красной фасоли</td>\n","      <td>[{'Вода': 0.3, 'unit': 'л'}, {'Картошка': 0.3,...</td>\n","      <td>варка</td>\n","      <td>Подготовить ингредиенты. Для приготовления суп...</td>\n","      <td>первое</td>\n","      <td>28.01.2013</td>\n","      <td>photo_1000menu_5.jpg</td>\n","      <td>https://1000.menu/cooking/38765-fasolevyi-sup-...</td>\n","      <td>[{'product_id': 828, 'name_source': 'Вода', 'u...</td>\n","      <td>['фасолевый', 'суп', 'красный', 'фасоль', 'под...</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-eaf8a283-21a3-4b97-a29e-ad5cb29c4125')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-eaf8a283-21a3-4b97-a29e-ad5cb29c4125 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-eaf8a283-21a3-4b97-a29e-ad5cb29c4125');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":93}]},{"cell_type":"code","source":["rec_data.shape"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"7i9u28p-uIik","executionInfo":{"status":"ok","timestamp":1658585911982,"user_tz":-180,"elapsed":352,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"939ac1a9-d82a-4b99-8c8c-40341b2457fa"},"execution_count":94,"outputs":[{"output_type":"execute_result","data":{"text/plain":["(27884, 11)"]},"metadata":{},"execution_count":94}]},{"cell_type":"code","source":["rec_data = rec_data[['name', 'Инструкции', 'text']][:10000]\n","rec_data.head()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"id":"4bFyGsHRJkDF","executionInfo":{"status":"ok","timestamp":1658585920920,"user_tz":-180,"elapsed":357,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"6e775174-e9e9-41ab-dff3-61891673f0b5"},"execution_count":95,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                                                name  \\\n","0  рассольник классический с перловкой и солеными...   \n","1                    Суп пюре из белокочаной капусты   \n","2                     Постные щи из квашеной капусты   \n","3                  Тюря- простой суп быстро и вкусно   \n","4                    Фасолевый суп из красной фасоли   \n","\n","                                          Инструкции  \\\n","0  Подготовить указанные ингредиенты для приготов...   \n","1  Необходимые ингредиенты\\r\\nНарезаем лук, морко...   \n","2  Честно признаюсь, у меня не было репы на момен...   \n","3  \\r\\nНачинаем мы приготовление тюри с того, что...   \n","4  Подготовить ингредиенты. Для приготовления суп...   \n","\n","                                                text  \n","0  ['рассольник', 'классический', 'перловка', 'со...  \n","1  ['суп', 'пюре', 'белокочаный', 'капуста', 'нео...  \n","2  ['постный', 'щи', 'квашеный', 'капуста', 'чест...  \n","3  ['тюря', 'простой', 'суп', 'быстро', 'вкусно',...  \n","4  ['фасолевый', 'суп', 'красный', 'фасоль', 'под...  "],"text/html":["\n","  <div id=\"df-cd210539-ea01-4e6b-b166-e0a6e94f9ca4\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>name</th>\n","      <th>Инструкции</th>\n","      <th>text</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>рассольник классический с перловкой и солеными...</td>\n","      <td>Подготовить указанные ингредиенты для приготов...</td>\n","      <td>['рассольник', 'классический', 'перловка', 'со...</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>Суп пюре из белокочаной капусты</td>\n","      <td>Необходимые ингредиенты\\r\\nНарезаем лук, морко...</td>\n","      <td>['суп', 'пюре', 'белокочаный', 'капуста', 'нео...</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>Постные щи из квашеной капусты</td>\n","      <td>Честно признаюсь, у меня не было репы на момен...</td>\n","      <td>['постный', 'щи', 'квашеный', 'капуста', 'чест...</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>Тюря- простой суп быстро и вкусно</td>\n","      <td>\\r\\nНачинаем мы приготовление тюри с того, что...</td>\n","      <td>['тюря', 'простой', 'суп', 'быстро', 'вкусно',...</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>Фасолевый суп из красной фасоли</td>\n","      <td>Подготовить ингредиенты. Для приготовления суп...</td>\n","      <td>['фасолевый', 'суп', 'красный', 'фасоль', 'под...</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-cd210539-ea01-4e6b-b166-e0a6e94f9ca4')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-cd210539-ea01-4e6b-b166-e0a6e94f9ca4 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-cd210539-ea01-4e6b-b166-e0a6e94f9ca4');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":95}]},{"cell_type":"code","source":["from sklearn.feature_extraction.text import CountVectorizer\n","from sklearn.linear_model import LogisticRegression\n","\n","vectorizer = CountVectorizer(ngram_range=(1, 2))"],"metadata":{"id":"vhYMrTp0uK2X","executionInfo":{"status":"ok","timestamp":1658585937972,"user_tz":-180,"elapsed":364,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":96,"outputs":[]},{"cell_type":"code","source":["idxs = set(np.random.randint(0, len(index_map), len(rec_data)))"],"metadata":{"id":"kEiUhw5iuYwo","executionInfo":{"status":"ok","timestamp":1658585940980,"user_tz":-180,"elapsed":354,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":97,"outputs":[]},{"cell_type":"code","source":["negative_texts = [\" \".join(preprocess_txt(index_map[i])) for i in idxs]"],"metadata":{"id":"cJzjI1eiL0Nk","executionInfo":{"status":"ok","timestamp":1658586081839,"user_tz":-180,"elapsed":138383,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":98,"outputs":[]},{"cell_type":"code","source":["positive_texts = [\" \".join(val) for val in rec_data['text'].values]"],"metadata":{"id":"98ZRrnQeMJIY","executionInfo":{"status":"ok","timestamp":1658586111542,"user_tz":-180,"elapsed":890,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":99,"outputs":[]},{"cell_type":"code","source":["dataset = negative_texts + positive_texts\n","labels = np.zeros(len(dataset))\n","labels[len(negative_texts):] = np.ones(len(positive_texts))"],"metadata":{"id":"-r2m6zEuMXrL","executionInfo":{"status":"ok","timestamp":1658586114643,"user_tz":-180,"elapsed":375,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":100,"outputs":[]},{"cell_type":"code","source":["from sklearn.model_selection import train_test_split\n","\n","X_train, X_test, y_train, y_test = train_test_split(dataset, labels, test_size=0.3, stratify=labels,\n","                                                    random_state=13)"],"metadata":{"id":"WziqA9K1Mp2D","executionInfo":{"status":"ok","timestamp":1658586116978,"user_tz":-180,"elapsed":1,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":101,"outputs":[]},{"cell_type":"code","source":["x_train_vec = vectorizer.fit_transform(X_train)\n","x_test_vec = vectorizer.transform(X_test)\n","\n","lr = LogisticRegression().fit(x_train_vec, y_train)"],"metadata":{"id":"XZgmPcc4M_6V","executionInfo":{"status":"ok","timestamp":1658586125077,"user_tz":-180,"elapsed":5677,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":102,"outputs":[]},{"cell_type":"code","source":["from sklearn.metrics import accuracy_score\n","accuracy_score(y_true=y_test, y_pred=lr.predict(x_test_vec))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"feJHkG3rNDaF","executionInfo":{"status":"ok","timestamp":1658586128749,"user_tz":-180,"elapsed":364,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"3cc620e5-94d0-4236-d0cc-0af40132ddd7"},"execution_count":103,"outputs":[{"output_type":"execute_result","data":{"text/plain":["0.845665608819108"]},"metadata":{},"execution_count":103}]},{"cell_type":"code","source":["from sklearn.feature_extraction.text import TfidfVectorizer\n","\n","tfidf_vect = TfidfVectorizer().fit(X_train)\n","np.mean(tfidf_vect.idf_)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"J9GMDyuVNP18","executionInfo":{"status":"ok","timestamp":1658586133750,"user_tz":-180,"elapsed":2136,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"2627d8d4-e239-4164-8488-24398b8618d0"},"execution_count":104,"outputs":[{"output_type":"execute_result","data":{"text/plain":["9.56586926331154"]},"metadata":{},"execution_count":104}]},{"cell_type":"code","source":["idfs = {v[0]: v[1] for v in zip(tfidf_vect.vocabulary_, tfidf_vect.idf_)}"],"metadata":{"id":"ZkNtl9BzODJz","executionInfo":{"status":"ok","timestamp":1658586136638,"user_tz":-180,"elapsed":454,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":105,"outputs":[]},{"cell_type":"code","source":["ft_index_rec = annoy.AnnoyIndex(100 ,'angular')\n","\n","midf = np.mean(tfidf_vect.idf_)\n","\n","index_map_rec = {}\n","counter = 0\n","\n","for i in tqdm_notebook(range(len(rec_data))):\n","    n_ft = 0\n","    index_map_rec[counter] = (rec_data.loc[i, \"name\"], rec_data.loc[i, \"Инструкции\"])\n","    vector_ft = np.zeros(100)\n","    for word in rec_data.loc[i, \"text\"]:\n","        if word in modelFT.wv:\n","            vector_ft += modelFT.wv[word] * 1 # idfs.get(word, midf)\n","            n_ft += 1 # idfs.get(word, midf)\n","    if n_ft > 0:\n","        vector_ft = vector_ft / n_ft\n","    ft_index_rec.add_item(counter, vector_ft)\n","    counter += 1\n","\n","ft_index_rec.build(10)\n","ft_index_rec.save(path_index_recepies_ann)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":118,"referenced_widgets":["fa8f01a2a44c43c08861ada91efedafa","3f68cf4378014b9e909bd550dc192303","5898aa5868554765934c793122228db4","ace8a73b8b0e42f4a0c09f88d3da084f","8b8765dfdeb2463697e09c0b443d1397","f178cc45cbb84a32916e80633b02b72c","26b7f7b478cd49eab9bbab15e9cc94ba","5709f5220d4246b38715778b0e893c0d","472c11324ef24dff8470c4914a092952","ae1ccffb9bb145688e497e5129a78cfc","f1715ef2dc38432ab34591cdc487db5d"]},"id":"PC_kitEuOKZI","executionInfo":{"status":"ok","timestamp":1658586340363,"user_tz":-180,"elapsed":189648,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"e552abc7-6d74-499d-f1f8-9b90474ce311"},"execution_count":106,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:8: TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0\n","Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`\n","  \n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/10000 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"fa8f01a2a44c43c08861ada91efedafa"}},"metadata":{}},{"output_type":"execute_result","data":{"text/plain":["True"]},"metadata":{},"execution_count":106}]},{"cell_type":"code","source":["with open(path_index_recepies, \"wb\") as f:\n","    pickle.dump(index_map_rec, f)"],"metadata":{"id":"_Dm4sOS7Qa8W","executionInfo":{"status":"ok","timestamp":1658586346745,"user_tz":-180,"elapsed":360,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":107,"outputs":[]},{"cell_type":"code","source":["with open(path_index_recepies, 'rb') as f:\n","    index_map_rec = pickle.load(f)"],"metadata":{"id":"mXG_QurGULUe","executionInfo":{"status":"ok","timestamp":1658586349482,"user_tz":-180,"elapsed":355,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}}},"execution_count":108,"outputs":[]},{"cell_type":"code","source":["ft_index_rec = annoy.AnnoyIndex(100, 'angular')\n","ft_index_rec.load(path_index_recepies_ann) \n","\n","midf = np.mean(tfidf_vect.idf_)\n","ft_index_rec.get_nns_by_vector(np.zeros(100), 3, include_distances=True)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"XvHSM69xUWTY","executionInfo":{"status":"ok","timestamp":1658586388660,"user_tz":-180,"elapsed":367,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"44fdf3f7-a36e-4a84-af07-21428ebbb4e1"},"execution_count":110,"outputs":[{"output_type":"execute_result","data":{"text/plain":["([774, 786, 805], [1.4142135381698608, 1.4142135381698608, 1.4142135381698608])"]},"metadata":{},"execution_count":110}]},{"cell_type":"code","source":["# Тест модели для рецептов\n","vect_ft = embed_txt(preprocess_txt('Фасолевый суп из красной фасоли'), idfs, midf)\n","ft_index_rec_val = ft_index_rec.get_nns_by_vector(vect_ft, 3)\n","for item in ft_index_rec_val:\n","  name, ins = index_map_rec[item]\n","  print(f\"блюдо: {name} инструкция: {ins}\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"NLwbf19hWDmO","executionInfo":{"status":"ok","timestamp":1658586396360,"user_tz":-180,"elapsed":346,"user":{"displayName":"Алексей Жилин","userId":"17139551399628034626"}},"outputId":"69ee7f49-da01-4cf6-e002-8e4b67a0427d"},"execution_count":111,"outputs":[{"output_type":"stream","name":"stdout","text":["блюдо: Салат из огурцов и лука инструкция: Все овощи, кроме перчиков Чили, нарежьте. Смешайте в чашке.\r\n","Посолите.\r\n","Залейте салат из огурцов и лука уксусом. Помешайте.\r\n","Выложите зелёные перчики чили целиком.\r\n","Поставьте салат в холодильник на 10 минут. Подавайте охлаждённым.\n","блюдо: Котлеты из свеклы инструкция: 1. Свеклу очистить от кожуры, промыть и натереть на терке. Полученную массу разделать в виде котлет, обвалять в сухарях и обжарить в масле.\n","блюдо: Луковые котлеты инструкция: 1. В мелко нарубленный лук добавляем яйца, соль и муку. Лепим котлеты, обваливаем в муке, обжариваем на сковороде.\r\n","2. Выкладываем котлеты в кастрюльку, прослаивая слегка обжаренной нарезанной морковью, заливаем водой или сметанным соусом, тушим в духовке 30–40 минут.\n"]}]},{"cell_type":"markdown","source":["### Функции бота"],"metadata":{"id":"FC3_Hxc4GoD5"}},{"cell_type":"code","source":["def is_intent_time(input_txt):\n","  res = False\n","  if len(input_txt) < 6:\n","    for word in input_txt:\n","      if word == 'время' or word == 'час':\n","        res = True\n","\n","  return res"],"metadata":{"id":"_jPdV5zNvNBC"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["def is_intent_5k(input_txt):\n","  res = False\n","  if len(input_txt) < 6:\n","    for word in input_txt:\n","      if word == 'пятёрочка' or word == 'пятерочка':\n","        res = True\n","\n","  return res  "],"metadata":{"id":"9N_bWvr9J_lW"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["var_otv = {'yes': 1, 'no' : 2, 'dialog' : 0}"],"metadata":{"id":"8eDBC1jwtQpx"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["def is_yes_no(input_txt):\n","  var = var_otv.get('dialog')\n","  if input_txt == 'да' or input_txt == 'Да':\n","    var = var_otv.get('yes')\n","  elif input_txt == 'нет' or  input_txt =='Нет':\n","    var =  var_otv.get('no')\n","  elif (len(input_txt.split()) > 1) and (input_txt.split()[0]=='да' or input_txt.split()[0] == 'Да'):\n","    var = var_otv.get('yes')\n","\n","  return var"],"metadata":{"id":"t3IVWabB2IKn"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Блок парсинга Пятёрочки"],"metadata":{"id":"SeHByb4-_COd"}},{"cell_type":"code","source":["from pathlib import Path\n","import time\n","import json\n","import requests"],"metadata":{"id":"FKops0lm_HO-"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["class Parse5ka:\n","    headers = {\"User-Agent\": \"ucheba\"}\n","\n","    def __init__(self, start_url: str):\n","        self.start_url = start_url\n","\n","    def _get_response(self, url, *args, **kwargs) -> requests.Response:\n","        while True:\n","            response = requests.get(url, *args, **kwargs, headers=self.headers)\n","            if response.status_code in (200, 301, 304):\n","                return response\n","            time.sleep(1)\n","\n","    def run(self):\n","        prod = dict()\n","        for product in self._parse(self.start_url):\n","            prod[product['name']] = product['current_prices'].get('price_promo__min')\n","        return prod\n","        \n","    def _parse(self, url):\n","        while url:\n","            response = self._get_response(url)\n","            data: dict = response.json()\n","            url = data.get(\"next\")\n","            for product in data.get(\"results\", []):\n","                yield product"],"metadata":{"id":"ahAXQ1Bw_LK3"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["parser = Parse5ka(\"https://5ka.ru/api/v2/special_offers/\")\n","product = parser.run()"],"metadata":{"id":"YpUMdt2sCu9n"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["def price5k(prod = 'колбаса'):\n","  return [f'{key} - {val}р.' for key, val in product.items() if key.lower().find(prod.lower())!=-1]"],"metadata":{"id":"pIMGJAJvSsfJ"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Блок соединения с телеграм ботом"],"metadata":{"id":"4unAPB6ugM5s"}},{"cell_type":"code","source":["#@Aleksey_educ_bot#\n","#создание бота в Telegramm - BotFather "],"metadata":{"id":"DkE_a066FZ2f"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["import os\n","import logging\n","from telegram import Update\n","from telegram.ext import Updater, CommandHandler, MessageHandler, Filters, CallbackContext"],"metadata":{"id":"H0MX1gy1twfs"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# Создадим соединение с ботом\n","updater = Updater(\"5393420496:AAFk_-R2VQH94tQUsaDqjYZC6twdwMltzPA\", use_context=True)  # Токен API к Telegram\n","dispatcher = updater.dispatcher"],"metadata":{"id":"h1Jy_n4QfjhB"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["def startCommand(update: Update, context: CallbackContext):\n","    update.message.reply_text('Добрый день! Я учебный бот @Aleksey_educ_bot')\n","    update.message.reply_text('Могу просто поболтать')\n","    update.message.reply_text('Сказать рецепт блюда')\n","    update.message.reply_text('Показать скидки на продукты в Пятёрочке')\n","    update.message.reply_text('Подсказать наше время')"],"metadata":{"id":"J98GR5yGgG5Y"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["intent = []\n","last_txt = ''"],"metadata":{"id":"QnPqx0nI3ZYt"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["def textMessage(update: Update, context: CallbackContext):\n","  otv_var = is_yes_no(update.message.text)\n","  global last_txt, price5k\n","  \n","  if otv_var == var_otv.get('yes'):\n","    if intent[0] == 'time':\n","      intent.clear()\n","      today = datetime.datetime.now()\n","      update.message.reply_text(f'у нас {today.strftime(\"%H.%M\")}') \n","    elif intent[0] == '5k':\n","      intent.clear()\n","\n","      if len(update.message.text.split()) > 1:\n","        prod = price5k(\" \".join(update.message.text.split()[1:]))\n","        if len(prod) > 0:\n","          for mes in prod:\n","            update.message.reply_text(mes)\n","        else:\n","            update.message.reply_text('Извините, на указанный продукт нет скидок')\n","      else:\n","        # колбаса\n","        for mes in price5k():\n","          update.message.reply_text(mes)\n","  \n","  elif otv_var == var_otv.get('no'):\n","    intent.clear()\n","    input_txt = last_txt\n","    last_txt = ''\n","  elif otv_var == var_otv.get('dialog'):\n","    input_txt = preprocess_txt(update.message.text)\n","\n","  if otv_var == var_otv.get('dialog') and len(intent) == 1:  \n","    update.message.reply_text('выберете вариант ответа \"да\" или \"нет\"')\n","  elif otv_var == var_otv.get('dialog') and is_intent_time(input_txt):\n","    update.message.reply_text('вы хотите узнать который час?')\n","    intent.append('time')\n","    last_txt = input_txt\n","  elif otv_var == var_otv.get('dialog') and is_intent_5k(input_txt):\n","    update.message.reply_text('вы хотите узнать скидки в Пятёрочке? (после Да, можно указать продукт)')\n","    intent.append('5k')\n","    last_txt = input_txt\n","  elif otv_var == var_otv.get('dialog') or otv_var == var_otv.get('no'): \n","    vect = vectorizer.transform([\" \".join(input_txt)])\n","    prediction = lr.predict(vect)\n","    \n","    if prediction[0] == 1:\n","        vect_ft = embed_txt(input_txt, idfs, midf)\n","        ft_index_shop_val = ft_index_rec_val.get_nns_by_vector(vect_ft, 3)\n","        for item in ft_index_shop_val:\n","            name, ins = index_map_rec[item]\n","            update.message.reply_text(f\"блюдо: {name} инструкция: {ins}\")\n","        return\n","    vect_ft = embed_txt(input_txt, {}, 1)\n","    ft_index_val, distances = ft_index.get_nns_by_vector(vect_ft, 1, include_distances=True)\n","    if distances[0] > 0.35:\n","        print(distances[0])\n","        update.message.reply_text(\"Извините, я вас не понимаю\")\n","        return\n","    update.message.reply_text(index_map[ft_index_val[0]])"],"metadata":{"id":"M6Ckp9n_gy4y"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# on different commands - answer in Telegram\n","dispatcher.add_handler(CommandHandler(\"start\", startCommand))\n","dispatcher.add_handler(MessageHandler(Filters.text & ~Filters.command, textMessage))\n","\n","# Start the Bot\n","updater.start_polling()\n","updater.idle()"],"metadata":{"id":"IdS9f9CJggo_"},"execution_count":null,"outputs":[]}]}